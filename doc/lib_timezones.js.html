<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/timezones.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/timezones.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Handle timezones
 * @author Antonio Olmo Titos &lt;antonio@w3.org>
 * @exports lib/timezones
 */

// External packages:
const MOMENT_TIMEZONE = require('moment-timezone');

// Internal packages:
const LOGGING = require('./logging'),
    UTIL = require('./util');

// Constants:
const // REGEX_TZ_CODE = /^[A-Z]{2,4}$/,
    REGEX_TZ_CONTINENT_AND_COUNTRY = /^[^\/]+\/[^\/]+$/,
    REGEX_REPLACE_DASHES = /_/gi,
    FORMAT_DATETIME = 'ddd, D MMM Y, H:mm';

// Variables:
var zones;

/**
 * Set up timezones
 */

const setUp = function() {
    if (zones)
        LOGGING.warn(`“timezones.setUp()” called more than once`);
    else {
        zones = MOMENT_TIMEZONE.tz.names();
        const // codes = zones.filter(v => { return v.match(REGEX_TZ_CODE); }),
            continentAndCountry = zones.filter(function(v) {
                return v.match(REGEX_TZ_CONTINENT_AND_COUNTRY);
            }),
            // others = zones.filter(v => { return !v.match(REGEX_TZ_CODE) &amp;&amp; !v.match(REGEX_TZ_CONTINENT_AND_COUNTRY); }),
            continents = {UTC: {UTC: 'UTC/UTC'}};
        continentAndCountry.forEach(function(i) {
            const p = i.replace(REGEX_REPLACE_DASHES, '&amp;nbsp;').split('/');
            if ('Etc' !== p[0]) {
                if (!continents.hasOwnProperty(p[0]))
                    continents[p[0]] = {};
                if (!continents[p[0]].hasOwnProperty(p[1]))
                    continents[p[0]][p[1]] = i;
            }
        });
        // Export more stuff:
        // exports.tzCodes = codes;
        exports.tzContinents = continents;
        // exports.tzOthers = others;
        exports.timezoneExists = timezoneExists;
        exports.processTimezone = processTimezone;
        exports.shiftTime = shiftTime;
    }
};

/**
 * Check if a string corresponds to a known timezone
 * @param {String} tz - the string
 * @returns {Boolean} whether it's a valid timezone
 */

const timezoneExists = function(tz) {
    return zones.includes(tz);
};

/**
 * @TODO: Document this.
 */

const processTimezone = function(data) {
    const correctedTimezone = 'UTC/UTC' === data.tz ? 'UTC' : data.tz;
    const m = new MOMENT_TIMEZONE().tz(correctedTimezone),
        abbrs = m._z.abbrs,
        offset = m._offset;
    LOGGING.dir(m);
    data.time = m.tz(correctedTimezone).format(FORMAT_DATETIME);
    data.offset = UTIL.formatDuration(offset, true);
    data.related = Array.from(new Set(abbrs));
    LOGGING.dir(data);
};

/**
 * Return the equivalent date-time in a different timezone
 * @param {String} to - the target timezone
 * @param {Object} time - (optional) the date-time (&lt;code>now()&lt;/code> if not present)
 * @returns {Object} the equivalent date-time
 */

const shiftTime = function(to, time) {
    const t = time ? time : new MOMENT_TIMEZONE();
    const result = t.tz(to).format();
    return result;
};

// Export stuff:
exports.setUp = setUp;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="lib_authentication.module_js.html">lib/authentication.js</a></li><li><a href="lib_logging.module_js.html">lib/logging.js</a></li><li><a href="lib_persistence.module_js.html">lib/persistence.js</a></li><li><a href="lib_routing.module_js.html">lib/routing.js</a></li><li><a href="lib_timezones.module_js.html">lib/timezones.js</a></li><li><a href="lib_util.module_js.html">lib/util.js</a></li><li><a href="server.module_js.html">server.js</a></li><li><a href="static_js_behaviour.module_js.html">static/js/behaviour.js</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Jul 05 2016 16:06:52 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
